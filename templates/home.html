{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Home</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <!-- Google Fonts and Material Icons -->

  <link rel="stylesheet" type="text/css" href="{% static 'css/home.css' %}">
</head>

<body>

<!-- Sidebar Container
  <aside class="w-64 bg-white border-r shadow-md flex flex-col justify-between p-4">
    <div> -->
      <!-- Logo -->
      <!-- <div class="flex items-center space-x-2 mb-8 text-green-600 font-bold text-xl">
        <span class="text-2xl">🟢</span>
        <span>EcoLife</span>
      </div> -->
      <!-- Search (optional) -->
      <!-- <div class="mb-4">
        <input type="text" placeholder="Search..."
          class="w-full px-3 py-2 rounded-md bg-gray-100 text-sm focus:outline-none">
      </div> -->
      <!-- <centre>
        <h2> Today's Environmental Tip 🌿</h2>
      <p>{{ recommendation }}</p>
      <p>end</p>
      </centre> -->
      <!-- <br><br><br><br>
      </div> -->
      <!-- <center>
        <div class="result">
            <h3>Your Daily Streak:</h3>
            <p>{{ streak }} day(s) 🔥</p>
        </div>
    </center>.  -->
        <!-- Navigation Menu
      <nav class="space-y-2 text-gray-700 font-medium text-sm">
        <a href="#" class="flex items-center p-2 rounded-lg bg-green-100 text-green-700 font-semibold">
          <span class="material-icons mr-3">dashboard</span> Dashboard
        </a>
        <a href="#" class="flex items-center p-2 rounded-lg hover:bg-gray-100">
          <span class="material-icons mr-3">chat</span> Chatbot
        </a>
        <a href="#" class="flex items-center p-2 rounded-lg hover:bg-gray-100">
          <span class="material-icons mr-3">whatshot</span> Streak
        </a>
        <a href="#" class="flex items-center p-2 rounded-lg hover:bg-gray-100">
          <span class="material-icons mr-3">eco</span> Eco Facts
        </a>
        <a href="#" class="flex items-center p-2 rounded-lg hover:bg-gray-100">
          <span class="material-icons mr-3">quiz</span> Quiz & Polls
        </a>
        <a href="#" class="flex items-center p-2 rounded-lg hover:bg-gray-100">
          <span class="material-icons mr-3">group</span> Community
        </a>
        <a href="#" class="flex items-center p-2 rounded-lg hover:bg-gray-100">
          <span class="material-icons mr-3">flag</span> Challenges
        </a>
        <a href="#" class="flex items-center p-2 rounded-lg hover:bg-gray-100">
          <span class="material-icons mr-3">handshake</span> Partners
        </a>
        <a href="#" class="flex items-center p-2 rounded-lg hover:bg-gray-100">
          <span class="material-icons mr-3">mail_outline</span> Contact Us
        </a>
        <a href="#" class="flex items-center p-2 rounded-lg hover:bg-gray-100">
          <span class="material-icons mr-3">volunteer_activism</span> Contribute
        </a>
      </nav>
    </div> -->
    <!-- Bottom impact card -->
    <!-- <div class="text-sm bg-gray-100 p-3 rounded mt-6">
      <p class="font-semibold text-gray-800">Your Eco Impact</p>
      <p class="text-xs text-gray-600 mt-1">You’ve saved <strong>25kg CO2</strong> this month. Keep going!</p>
    </div> -->
  <!-- <div id="chatbot-container">
    <h3 id="chatbot-title">EcoBot 🌿</h3>
    <div id="chat-window"></div>
    <div>
      <input type="text" id="user-input" placeholder="Ask me about eco tips...">
      <button id="send-button" onclick="sendMessage()">Send</button>
    </div>
  </div> -->


  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg sticky-top">
    <div class="container">
      <!-- Brand/Logo -->
      <a class="navbar-brand  ms-0" href="#">
        <i class="bi bi-tree-fill"></i> EcoLife
      </a>
      
      <!-- Mobile Toggle Button -->
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      
      <!-- Nav Items -->
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav me-auto">
          <li class="nav-item">
            <a class="nav-link active" href="#"><i class="bi bi-house"></i> Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" onclick=scrollToChallenges()><i class="bi bi-trophy"></i> Challenges</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/community"><i class="bi bi-people"></i> Community</a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
              <i class="bi bi-graph-up"></i> Tools
            </a>
            <ul class="dropdown-menu">
              <li><button class="dropdown-item" onclick=openCalc()>Carbon Calculator</button></li>
              <li><button class="dropdown-item" onclick=openrecommendation()>Green Alternative Finder</button></li>
              <li><button class="dropdown-item" onclick=opencontribute()>Contribute</button></li>
            </ul>
          </li>
        </ul>
        
        <!-- Right-aligned items -->
        <div class="d-flex align-items-center">
          <div class="me-3 d-none d-lg-block">
            <span class="badge bg-primary p-2 text-light fs-6">
              <i class="bi bi-lightning-charge"></i> <span id="userEcoPoints">0</span> EcoPoints
            </span>
          </div>
          <div class="dropdown  px-2" >
            <a href="#" class="d-block link-dark text-decoration-none dropdown-toggle" id="dropdownUser" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="bi bi-person-circle" style="font-size: 2rem;"></i>
            </a>
            <ul class="dropdown-menu dropdown-menu-end me-5" aria-labelledby="dropdownUser" >
              <li>
                <button class="dropdown-item d-flex flex-direction-row align-items-center ">
                  Profile
                </button>
              </li>
              <li>
                <button class="dropdown-item d-flex align-items-center">
                  Settings
                </button>
              </li>
              <li><hr class="dropdown-divider"></li>
              <li>
                <button class="dropdown-item d-flex align-items-center" onclick="logout()">
                  Sign out
                </button>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </nav>

 

<div class="flex-1 p-6  ms-5 mt-5" style="position:relative">
  <h3 class="text-xl font-bold" id="welcome_back">Welcome back, Alex! 👋</h3>


<div id="toast" class="text-success bg-light fw-bold p-4" style="
visibility: hidden;
position: fixed;
text-align: center;
border-radius: 5px;
top:5;
right:5;
left:auto;
font-size:30px;">
Points Added!
</div>
</div>
<section class="stats-panel">
  <div class="stat-card">
    <div class="stat-header">
      <div>
        <h4>Carbon Saved</h4>
        <h2>25kg</h2>
        <p>You're in top 20% of users</p>
      </div>
      <span class="icon green">🍃</span>
    </div>
    <div class="progress-bar">
      <div class="progress-fill green" style="width: 68%;"></div>
    </div>
    <div class="progress-text">68%</div>
  </div>

  <div class="stat-card">
    <div class="stat-header">
      <div>
        <h4>Water Saved</h4>
        <h2>145L</h2>
        <p>12% increase from last month</p>
      </div>
      <span class="icon blue">💧</span>
    </div>
    <div class="progress-bar">
      <div class="progress-fill blue" style="width: 45%;"></div>
    </div>
    <div class="progress-text">45%</div>
  </div>

  <div class="stat-card">
    <div class="stat-header">
      <div>
        <h4>Green Energy</h4>
        <h2>78kWh</h2>
        <p>From renewable sources</p>
      </div>
      <span class="icon teal">🔌</span>
    </div>
    <div class="progress-bar">
      <div class="progress-fill teal" style="width: 52%;"></div>
    </div>
    <div class="progress-text">52%</div>
  </div>

  <div class="stat-card">
    <div class="stat-header">
      <div>
        <h4>Solar Impact</h4>
        <h2>35kWh</h2>
        <p>Energy from solar sources</p>
      </div>
      <span class="icon yellow">☀️</span>
    </div>
    <div class="progress-bar">
      <div class="progress-fill yellow" style="width: 30%;"></div>
    </div>
    <div class="progress-text">30%</div>
  </div>
</section>

<div class="container py-4">
  <div class="row g-4">
    <!-- Left Column - Stacked EcoStreak and EcoQuote (wider now) -->
    <div class="col-lg-6 col-md-6">
      <!-- EcoStreak Card (wider) -->
      <div class="card shadow-sm mb-4 w-100">
        <div class="card-body">
          <h2 class="card-title h3 text-success">Your EcoStreak</h2>
          <p class="card-subtitle text-muted mb-3">Keep tracking your environmental impact daily</p>
          
          <div class="d-flex justify-content-around mb-4">
            <div class="text-center px-3">
              <div class="fs-1 text-warning">🔥</div>
              <div class="h4 fw-bold">1 day</div>
              <div class="text-muted">Current Streak</div>
            </div>
            
            <div class="text-center px-3">
              <div class="fs-1 text-secondary">🔒</div>
              <div class="h4 fw-bold">1 day</div>
              <div class="text-muted">Longest Streak</div>
            </div>
          </div>
          
          <div class="mb-3">
            <div class="d-flex justify-content-between mb-2">
              <span class="fw-bold">Monthly Goal</span>
              <span class="fw-bold text-success">0%</span>
            </div>
            <div class="progress" style="height: 12px;">
              <div class="progress-bar bg-success progress-bar-striped" role="progressbar" style="width: 60%;" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"></div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- EcoQuote Card (more compact height) -->
       <!-- fixed -->
  <!-- <div class="quote-card">
    <h2>Daily Eco Quote</h2>
    {% if random_quote %}
      <div class="quote-box">
        <div class="quote-icon">💡</div>
        <div class="quote-content">
          <p class="quote-text">"{{ random_quote.text }}"</p>
          {% if random_quote.author %}
          <p class="quote-author">— {{ random_quote.author }}</p>
          {% endif %}
        </div>
      </div>
    {% else %}
      <p class="quote-fallback">No quotes available.</p>
    {% endif %}
   </div>  -->
      <div class="card quote-card shadow-sm h-39 w-100" style="min-height: 200px;">
        <div class="card-body d-flex flex-column ">
          <h2 class="card-title h3 text-success mb-3">Daily Eco Quote</h2>
          {% if random_quote %}
          <div class="d-flex align-items-start flex-grow-1">
            <div class="me-3 fs-3 text-info">💡</div>
            <div class="d-flex flex-column justify-content-center">
              <blockquote class="blockquote mb-0">
                <p class="fst-italic fs-5 mb-0">"{{ random_quote.text }}"</p>
                {% if random_quote.author %}
                <p class="quote-author">— {{ random_quote.author }}</p>
                {% endif %}
              </blockquote>
            </div>
          </div>
          {% else %}
          <div class="d-flex align-items-start flex-grow-1">
            <div class="d-flex flex-column justify-content-center">
              <blockquote class="blockquote mb-0">
                <p class="fst-italic fs-5 mb-0">"No Quote Available"</p>
              </blockquote>
            </div>
          </div>
          {% endif %}
          <div class="text-center mt-3">
            <button class="btn btn-outline-success w-100 py-2" type="button" data-bs-toggle="collapse" data-bs-target="#calculatorTips">
              <i class="bi bi-lightbulb me-2"></i> Tips for Reducing Your Footprint
            </button>
          </div>
        </div>
        
        <div class="collapse" id="calculatorTips">
          <div class="card-footer bg-light">
            <ul class="list-unstyled mb-0">
              <li class="mb-2"><i class="bi bi-check-circle-fill text-success me-2"></i> Switch to LED bulbs (saves ~75% electricity)</li>
              <li class="mb-2"><i class="bi bi-check-circle-fill text-success me-2"></i> Walk/bike for trips under 3km</li>
              <li class="mb-2"><i class="bi bi-check-circle-fill text-success me-2"></i> Try meatless Mondays</li>
              <li><i class="bi bi-check-circle-fill text-success me-2"></i> Choose video conferences over short flights</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Right Column - EcoAssistant (much wider) -->
    <div class="col-lg-6 col-md-6">
      <div class="card shadow-sm h-100  w-100">
        <div class="card-header bg-success text-white d-flex justify-content-between align-items-center py-3">
          <h5 class="mb-0 fw-bold fs-4">EcoAssistant</h5>
          <span class="badge bg-light text-success fs-6 py-2">✔ Active</span>
        </div>
        <div class="card-body d-flex flex-column p-0" style="min-height: 350px;">
          <div id="chat-window" class="p-4 flex-grow-1 d-flex flex-column justify-content-center">
            <div id="initial-prompt" class="text-center">
              <h3 class=" mb-3" style="background: linear-gradient(135deg, #6366F1 0%, #674ea0 50%, #ec48ce 100%);-webkit-background-clip: text;
              background-clip: text;
              color: transparent;
              text-shadow: 0 2px 10px rgba(99, 102, 241, 0.2);
              font-size: 2.5rem;
              font-weight: 650;
              margin-bottom: 0;">Ask Assistant</h3>
              <p class="text-muted fs-5">Ask me anything about sustainable living</p>
            </div>
          </div>
          <div class="input-group p-3 border-top">
            <input type="text" id="user-input" class="form-control form-control-lg border-success" placeholder="Type your eco-question here..." autocomplete="off">
            <button id="send-button" class="btn btn-success px-4 py-2">
              <i class="bi bi-send-fill fs-5"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
  <!-- <center>
    <h1>Carbon Footprint Calculator</h1>
    <form method="POST" action="/predict/">
      {% csrf_token %}
      
      Daily Electricity Usage (kWh): 
      <input type="number" name="electricity" step="0.1" min="0" required><br><br>
  
      Daily Car Travel (km): 
      <input type="number" name="car_km" step="0.1" min="0" required><br><br>
  
      Meat Meals per Week: 
      <input type="number" name="meat_meals" min="0" required><br><br>
  
      Flights per Year: 
      <input type="number" name="flights" min="0" required><br><br>
  
      <button type="submit">Submit</button>
    </form>
  </center>
   -->
 
  <!--just to differentiate-->

  <div class="text-center my-4" id="carbon-section">
    <button id="toggleCalculatorBtn" class="btn btn-primary">
      <i class="bi bi-calculator"></i> Calculate Your Carbon Footprint
    </button>
  </div>


  <div id="calculatorSection" style="display:none" class="carbon-calculator py-5 bg-success-subtle calculator-section">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-lg-8">
          <div class="card shadow-sm border-0 overflow-hidden">
            <div class="card-header bg-success text-white py-3">
              <h1 class="h3 mb-0 text-center">
                <i class="bi bi-calculator me-2"></i> Carbon Footprint Calculator
              </h1>
            </div>
            <div class="card-body p-4 p-md-5">
              <p class="text-muted text-center mb-4">
                Calculate your environmental impact and discover ways to reduce your carbon footprint
              </p>

              <form method="POST" action="/predict/" class="needs-validation" novalidate>
                {% csrf_token %}

                <!-- Electricity Usage-->
                <div class="mb-4">
                  <label for="electricity" class="form-label">
                    <i class="bi bi-lightning-charge-fill text-warning me-2"></i>
                    Daily Electricity Usage (kWh)
                  </label>
                  <div class="input-group">
                    <input type="number" class="form-control" id="electricity" name="electricity" step="0.1" min="0"
                      required>
                    <span class="input-group-text">kWh/day</span>
                  </div>
                  <div class="form-text">Average household uses 20-30 kWh/day</div>
                </div>

                <!-- Car Travel -->
                <div class="mb-4">
                  <label for="car_km" class="form-label">
                    <i class="bi bi-car-front-fill text-primary me-2"></i>
                    Daily Car Travel Distance
                  </label>
                  <div class="input-group">
                    <input type="number" class="form-control" id="car_km" name="car_km" step="0.1" min="0" required>
                    <span class="input-group-text">km/day</span>
                  </div>
                  <div class="form-text">Consider carpooling or public transport to reduce</div>
                </div>

                <!-- Meat Consumption -->
                <div class="mb-4">
                  <label for="meat_meals" class="form-label">
                    <i class="bi bi-egg-fill text-danger me-2"></i>
                    Meat-Based Meals per Week
                  </label>
                  <input type="number" class="form-control" id="meat_meals" name="meat_meals" min="0" required>
                  <div class="form-text">Each vegetarian meal reduces your footprint by ~1.5kg CO₂</div>
                </div>

                <!-- Flights -->
                <div class="mb-4">
                  <label for="flights" class="form-label">
                    <i class="bi bi-airplane-fill text-info me-2"></i>
                    Short-Haul Flights per Year
                  </label>
                  <input type="number" class="form-control" id="flights" name="flights" min="0" required>
                  <div class="form-text">A single round-trip flight emits ~0.5 tons CO₂</div>
                </div>

                <div class="d-grid mt-4">
                  <button type="submit" class="btn btn-success btn-lg py-3">
                    <i class="bi bi-calculator-fill me-2"></i> Calculate My Footprint
                  </button>
                </div>
              </form>
            </div>

            <div class="card-footer bg-light text-center py-3">
              <small class="text-muted">
                <i class="bi bi-info-circle me-1"></i>
                Your data is used solely for calculation and never stored
              </small>
            </div>
          </div>



        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="resultModal" tabindex="-1" aria-labelledby="resultModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">

        <div class="modal-header bg-success text-white">
          <h5 class="modal-title" id="resultModalLabel">
            <i class="bi bi-patch-check-fill me-2"></i> Calculation Complete
          </h5>
          <!-- <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button> -->
        </div>

        <div class="modal-body text-center">

          {% if score %}
          <h4 class="text-success">Your Carbon Footprint has been calculated!</h4>
          <p class="mb-4">See your sustainability stats below:</p>

          <div class="bg-light border rounded p-3 text-start">
            <h5 class="text-center text-success mb-3">Your Sustainability Stats</h5>
            <p><strong>Carbon Footprint Score:</strong> {{ score }}</p>
            <p><strong>Recommendation:</strong> {{ recommendation }}</p>
            <p><strong>Average Score:</strong> {{ average_score }}</p>
            <p><strong>Comparison:</strong> {{ comparison }}</p>

            <form action="{% url 'reset_data' %}" method="post" class="mt-3 text-center">
              {% csrf_token %}
              <button id="ok" type="submit" class="btn btn-danger">OK</button>
            </form>
          </div>

          {% else %}
          <h4 class="text-muted">Please calculate your carbon footprint first.</h4>
          {% endif %}

        </div>

      </div>
    </div>
  </div>
  {% if score %}
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      var resultModal = new bootstrap.Modal(document.getElementById('resultModal'));
      resultModal.show();
    });
  </script>
  {% endif %}


  <div id="userTaskTab" class="tab-nav mb-3">
    <button class="tab-button active" data-tab="challenges">Challenges</button>
    <button class="tab-button" data-tab="learning">Learning</button>
    <button class="tab-button" data-tab="community">Community</button>
  </div>


<div id="userTasks" class="container d-flex flex-column gap-4 py-4">

      <!-- Challenges Section -->
      <div id="challenges"  class="challenges-section border border-success rounded p-4 tab-content active" style="background: linear-gradient(to left, #f0f8ec, #ffffff);">
        <h2 class="section-title mb-4">Active Challenges</h2>
        
        <div class="row g-4">
          <!-- Zero Waste Week Challenge -->
          <div class="col-md-4">
            <div class="challenge-card h-100 p-4 border rounded">
              <h3 class="mb-3">Zero Waste Week</h3>
              <p class="mb-4">Reduce your waste to a single jar for a week</p>
              <div class="challenge-stats">
                <span class="participants d-block mb-2">342 participants</span>
                <div class="progress-container">
                  <span class="progress-label d-block mb-1">Your Progress</span>
                  <div class="progress mb-2" style="height: 8px;">
                    <div class="progress-bar bg-success" style="width: 65%;"></div>
                  </div>
                  <span class="progress-percent text-end d-block">65%</span>
                </div>
              </div>
              <button class="challenge-btn btn btn-success w-100 mt-3">Join Challenge</button>
            </div>
          </div>
          
          <!-- Meatless Monday Challenge -->
          <div class="col-md-4">
            <div class="challenge-card h-100 p-4 border rounded">
              <h3 class="mb-3">Meatless Monday Challenge</h3>
              <p class="mb-4">Go vegetarian every Monday for a month</p>
              <div class="challenge-stats">
                <span class="participants d-block mb-2">567 participants</span>
                <div class="progress-container">
                  <span class="progress-label d-block mb-1">Your Progress</span>
                  <div class="progress mb-2" style="height: 8px;">
                    <div class="progress-bar bg-success" style="width: 40%;"></div>
                  </div>
                  <span class="progress-percent  text-end d-block">40%</span>
                </div>
              </div>
              <button class="challenge-btn btn btn-success w-100 mt-3">Join Challenge</button>
            </div>
          </div>
          
          <!-- Plastic-Free July Challenge -->
          <div class="col-md-4">
            <div class="challenge-card h-100 p-4 border rounded">
              <h3 class="mb-3">Plastic-Free April</h3>
              <p class="mb-4">Avoid single-use plastics all month</p>
              <div class="challenge-stats">
                <span class="participants d-block mb-2">215 participants</span>
                <div class="progress-container">
                  <span class="progress-label d-block mb-1">Your Progress</span>
                  <div class="progress mb-2" style="height: 8px;">
                    <div class="progress-bar bg-success" style="width: 85%;"></div>
                  </div>
                  <span class="progress-percent text-end d-block">85%</span>
                </div>
              </div>
              <button class="challenge-btn btn btn-success w-100 mt-3">Join Challenge</button>
            </div>
          </div>
        </div>
      </div>
    
    
    <!-- Quizzes Section - Custom Layout -->
    <div id="learning" class="quizzes-container border border-success rounded p-4 tab-content d-none" style="background: linear-gradient(to left, #f0f8ec, #ffffff);">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="section-title mb-0">Latest Quizzes</h2>
        
        <a onclick="gotoquiz()" class="btn btn-link text-light text-decoration-none px-3">QUIZ →</a>
      </div>
      
      <div class="row g-3">
        <!-- Climate Change Fundamentals Quiz -->
        <div class="col-md-6">
          <div class="card h-90 w-100 border-success">
            <div class="card-body d-flex flex-column p-4">
              <div class="d-flex justify-content-between align-items-start mb-3">
                <h3 class="card-title mb-0">Climate Change Fundamentals</h3>
                <span class="badge bg-success text-light py-1">New</span>
              </div>
              <p class="card-text mb-4">Test your knowledge about the basics of climate change</p>
              <ul class="list-unstyled mb-4">
                <li class="mb-2"><i class="bi bi-check-circle text-success me-2"></i>10 questions</li>
                <li><i class="bi bi-clock text-success me-2"></i>5 min</li>
              </ul>
              <button class="btn btn-success w-100 mt-auto">Take Quiz</button>
            </div>
          </div>
        </div>
        
        <!-- Sustainable Living Quiz -->
        <div class="col-md-6">
          <div class="card h-90 w-100 border-success">
            <div class="card-body d-flex flex-column p-4">
              <div class="d-flex justify-content-between align-items-start mb-3">
                <h3 class="card-title mb-0">Sustainable Living Quiz</h3>
                <span class="badge bg-success text-light py-1">Popular</span>
              </div>
              <p class="card-text mb-4">How sustainable is your lifestyle?</p>
              <ul class="list-unstyled mb-4">
                <li class="mb-2"><i class="bi bi-check-circle text-success me-2"></i>12 questions</li>
                <li><i class="bi bi-clock text-success me-2"></i>6 min</li>
              </ul>
              <button class="btn btn-success w-100 mt-auto">Take Quiz</button>
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="card h-90 w-100 border-success">
            <div class="card-body d-flex flex-column p-4">
              <div class="d-flex justify-content-between align-items-start mb-3">
                <h3 class="card-title mb-0">Climate Change Fundamentals</h3>
                <span class="badge bg-success text-light py-1">New</span>
              </div>
              <p class="card-text mb-4">Test your knowledge about the basics of climate change</p>
              <ul class="list-unstyled mb-4">
                <li class="mb-2"><i class="bi bi-check-circle text-success me-2"></i>10 questions</li>
                <li><i class="bi bi-clock text-success me-2"></i>5 min</li>
              </ul>
              <button class="btn btn-success w-100 mt-auto">Take Quiz</button>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card h-90 w-100 border-success">
            <div class="card-body d-flex flex-column p-4">
              <div class="d-flex justify-content-between align-items-start mb-3">
                <h3 class="card-title mb-0">Climate Change Fundamentals</h3>
                <span class="badge bg-success text-light py-1">New</span>
              </div>
              <p class="card-text mb-4">Test your knowledge about the basics of climate change</p>
              <ul class="list-unstyled mb-4">
                <li class="mb-2"><i class="bi bi-check-circle text-success me-2"></i>10 questions</li>
                <li><i class="bi bi-clock text-success me-2"></i>5 min</li>
              </ul>
              <button class="btn btn-success w-100 mt-auto">Take Quiz</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    
    <!-- Community Highlights Section -->
<div id="community" class="container my-2 tab-content d-none" style="background: linear-gradient(to left, #f0f8ec, #ffffff);">
  <div class="row" style="border:1px solid green">
    <div class="col-12 p-5">
      <h2 class="mb-4">Community Highlights</h2>
      <p class="text-muted mb-4 fs-6 fw-medium px-3">Recent popular posts from eco-community</p>
      
      <!-- Highlight Cards -->
      <div class="row">
        <!-- Emma's Post -->
        <div class="col-md-4">
          <div class="card h-80 w-100 border-0 shadow-sm">
            <div class="card-body">
              <div class="d-flex align-items-center mb-3">
                <div class="bg-success bg-opacity-10 rounded-circle p-3 me-3">
                  <span class="fw-bold text-success">EW</span>
                </div>
                <div>
                  <h5 class="mb-0">Emma Wilson</h5>
                  <small class="text-muted">2h ago</small>
                </div>
              </div>
              <h4 class="card-title">Started composting today!</h4>
              <p class="card-text">After months of planning, I finally set up my backyard compost...</p>
              <div class="d-flex gap-3">
                <span class="text-muted"><i class="bi bi-heart me-1"></i> 24</span>
                <span class="text-muted"><i class="bi bi-chat me-1"></i> 7</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Michael's Post -->
        <div class="col-md-4">
          <div class="card h-80 w-100 border-0 shadow-sm">
            <div class="card-body">
              <div class="d-flex align-items-center mb-3">
                <div class="bg-success bg-opacity-10 rounded-circle p-3 me-3">
                  <span class="fw-bold text-success">MC</span>
                </div>
                <div>
                  <h5 class="mb-0">Michael Chen</h5>
                  <small class="text-muted">5h ago</small>
                </div>
              </div>
              <h4 class="card-title">Beach cleanup results</h4>
              <p class="card-text">Our team collected over 50kg of plastic waste from Sunrise Beach this weekend...</p>
              <div class="d-flex gap-3">
                <span class="text-muted"><i class="bi bi-heart me-1"></i> 42</span>
                <span class="text-muted"><i class="bi bi-chat me-1"></i> 11</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Sofia's Post -->
        <div class="col-md-4">
          <div class="card h-80 w-100 border-0 shadow-sm">
            <div class="card-body">
              <div class="d-flex align-items-center mb-3">
                <div class="bg-success bg-opacity-10 rounded-circle p-3 me-3">
                  <span class="fw-bold text-success">SR</span>
                </div>
                <div>
                  <h5 class="mb-0">Sofia Rodriguez</h5>
                  <small class="text-muted">1d ago</small>
                </div>
              </div>
              <h4 class="card-title">Zero waste shopping tips</h4>
              <p class="card-text">Here's how I reduced my grocery packaging waste by 80% this month...</p>
              <div class="d-flex gap-3">
                <span class="text-muted"><i class="bi bi-heart me-1"></i> 37</span>
                <span class="text-muted"><i class="bi bi-chat me-1"></i> 15</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Explore Button -->
      <div class="text-center mt-3">
        <a href="/community" class="btn btn-success px-4 py-2 fw-bold">
          Explore <i class="bi bi-arrow-right ms-2"></i>
        </a>
      </div>
    </div>
  </div>
</div>
    
</div>
    

    
  
<!-- <button onclick="gotoquiz()">Quiz</button> -->
<!-- <button onclick="gotostats()">Stats</button> -->
<!-- <button onclick="logout()">Logout</button> -->



  <!-- Bootstrap JS (for collapses, modals, etc.) -->

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
     function gotoquiz(){
       window.location.href = `{% url 'quiz' %}`;
    }
     function gotostats(){
       window.location.href = `{% url 'stats' %}`;
    }
   function scrollToChallenges(){
  const section = document.getElementById("userTaskTab");
    if (section) {
      section.scrollIntoView({ behavior: 'smooth' });}
      
   }

    // function logout(){
    //   window.location.href = "/landing";
    // }
    // Initialize points variable for the logged-in user

document.addEventListener("DOMContentLoaded",()=>{
  // document.querySelector("#ok").addEventListener("click",()=>{
  if(parseInt(localStorage.getItem('pointIncreament'))){
    showToast(parseInt(localStorage.getItem('pointIncreament')));
    localStorage.setItem('pointIncreament',0);
  }

// });
});


// Get username from localStorage
const username = localStorage.getItem('username');
let points = parseInt(localStorage.getItem('points')) || 0;

function showToast(value) {
  console.log("added point" , value);
  const toast = document.getElementById("toast");
  toast.innerHTML = `${value} Eco Points! 🌿`;
  toast.style.visibility = "visible";
  setTimeout(() => {
    toast.style.visibility = "hidden";
  }, 3000); // Toast disappears after 2 seconds
}


if (!username) {
  // If username is not set, redirect back to landing
  window.location.href = `{% url 'landing' %}`;
} else {
  // points=0;
  console.log("Logged in as:", username);
  // Now you can use "username" anywhere in this script
}

// Example function to add points
function addPoints(value) { 
  points += value;
  localStorage.setItem('points', points);
  console.log(`${username}'s points:`, points);
  document.getElementById('userEcoPoints').innerHTML = `${points}`;
  localStorage.setItem('pointIncreament',value);
  
}


document.getElementById('welcome_back').innerHTML = `Welcome back, ${username}! 👋`;
document.getElementById('userEcoPoints').innerHTML = `${points}`;

// Logout function
function logout() {
  localStorage.removeItem('username'); // Clear saved username
  points = 0; // Reset points
  window.location.href = `{% url 'landing' %}`;
}


function checkScroll() {
  const chatWindow = document.getElementById('chat-window');
  if (chatWindow.scrollHeight > chatWindow.clientHeight) {
    chatWindow.style.overflowY = 'auto'; // Show scrollbar only when needed
  } else {
    chatWindow.style.overflowY = 'hidden';
  }
}
    document.addEventListener('DOMContentLoaded', function () {
      const userInput = document.getElementById('user-input');
      const chatWindow = document.getElementById('chat-window');
      const initialPrompt = document.getElementById('initial-prompt');
      const sendButton = document.getElementById('send-button');

      // Function to add message to chat
      function addMessage(text, isUser) {
        if (initialPrompt && chatWindow.contains(initialPrompt)) {
          initialPrompt.remove();
        }

        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${isUser ? 'user-message' : 'bot-message'}`;
        messageDiv.innerHTML = `<strong>${isUser ? 'You:' : 'EcoAssistant:'}</strong> ${text}`;

        if (isUser) {
          messageDiv.style.alignSelf = 'flex-end';
        } else {
          messageDiv.style.alignSelf = 'flex-start';
        }

        chatWindow.appendChild(messageDiv);
        checkScroll();
        chatWindow.scrollTop = chatWindow.scrollHeight;
        

      }

      // Function to handle sending message
      function sendMessage() {
        const message = userInput.value.trim();
        if (!message) return;

        addMessage(message, true);
        userInput.value = '';
        userInput.focus();

         
        fetch('/chatbot/', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message: message })
        })
        .then(response => response.json())
        .then(data => addMessage(data.reply, false))
        .catch(error => {
            console.error('Error:', error);
            addMessage("Sorry, I encountered an error. Please try again.", false);
        });
        
      }

      // Event listeners
      sendButton.addEventListener('click', sendMessage);
      userInput.addEventListener('keypress', function (e) {
        if (e.key === 'Enter') sendMessage();
      });

      initialPrompt?.addEventListener('click', function () {
        userInput.focus();
      });
    });


    document.querySelector("form").addEventListener("submit", function (e) {
      e.preventDefault();
      const form = this;
      
        const resultModal = new bootstrap.Modal(document.getElementById('resultModal'));
        resultModal.show();
        form.submit();
        addPoints(1);
     
    });



    function openrecommendation(){
      window.location.href = `{% url 'recommendation' %}`;

    }
    function opencontribute(){
      window.location.href = `{% url 'stats' %}`;

    }
    const toggleBtn = document.getElementById("toggleCalculatorBtn");
    const calculatorSection = document.getElementById("calculatorSection");
    function openCalc(){
      toggleBtn.click();
    }
    toggleBtn.addEventListener("click", () => {
      
      const isVisible = calculatorSection.style.display === "block";

      if (isVisible) {
        calculatorSection.style.display = "none";
        toggleBtn.innerHTML = '<i class="bi bi-calculator"></i> Calculate Your Carbon Footprint';
      } else {
        calculatorSection.style.display = "block";
        toggleBtn.innerHTML = '<i class="bi bi-x-circle-fill"></i> Close';

        window.scrollTo({ top: calculatorSection.offsetTop - 20, behavior: "smooth" });
      }
    });


    document.addEventListener('DOMContentLoaded', function() {
  const tabButtons = document.querySelectorAll('.tab-button');
  const tabContents = document.querySelectorAll('.tab-content');
  
  tabButtons.forEach(button => {
    button.addEventListener('click', function() {
      // Remove active class from all buttons and contents
      tabButtons.forEach(btn => btn.classList.remove('active'));
      tabContents.forEach(content => content.classList.add('d-none'));
      
      // Add active class to clicked button
      this.classList.add('active');
      
      // Show corresponding content
      const tabId = this.getAttribute('data-tab');
      document.getElementById(tabId).classList.remove('d-none');
    });
  });
  
  // Activate the first tab by default if none is active
  if (!document.querySelector('.tab-button.active')) {
    tabButtons[0].classList.add('active');
    tabContents[0].classList.remove('d-none');
  }
});


  </script>


</body>
</html>
